import { createClient } from '@supabase/supabase-js';
export default async function handler(req,res){ if(req.method!=='POST') return res.status(405).end(); try { const { slug } = req.body || {}; if(!slug) return res.status(400).json({error:'slug required'}); const supabase=createClient(process.env.NEXT_PUBLIC_SUPABASE_URL, process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:false,persistSession:false}}); const { data:guest } = await supabase.from('guests').select('id').eq('slug',slug).single(); if(!guest) return res.status(404).json({error:'not found'}); await supabase.from('guest_opens').insert({guest_id:guest.id}); return res.json({ok:true}); } catch(e){ console.error(e); return res.status(500).json({error:'server'}); } }
